<mxfile host="Electron" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/27.0.9 Chrome/134.0.6998.205 Electron/35.4.0 Safari/537.36" version="27.0.9">
  <diagram name="第 1 页" id="BuhThu6eWU-O1bp9HHT3">
    <mxGraphModel dx="1042" dy="626" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-1" value="AiServices" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="1" vertex="1">
          <mxGeometry x="150" y="80" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-137" value="AiServices" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="1" vertex="1">
          <mxGeometry x="160" y="90" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-2" value="AiServiceContext" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="1" vertex="1">
          <mxGeometry x="300" y="80" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-3" value="DefaultAiServices" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="1" vertex="1">
          <mxGeometry x="460" y="80" width="100" height="300" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-4" value="&lt;span&gt;AiServiceContext&lt;/span&gt;" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fontSize=14;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;locked=0;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="1480" y="80" width="520" height="728" as="geometry">
            <mxRectangle x="1480" y="80" width="150" height="30" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-5" value="+ DEFAULT_MESSAGE_PROVIDER: Function&amp;lt;Object, Optional&amp;lt;String&amp;gt;&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;默认消息提供者，返回空的Optional" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-4" vertex="1">
          <mxGeometry y="26" width="520" height="40" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-12" value="+ aiServiceClass: Class&amp;lt;?&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;//&amp;nbsp;AI服务的类对象（AI服务相关&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;）&lt;/span&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-4" vertex="1">
          <mxGeometry y="66" width="520" height="26" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-13" value="+ chatModel: ChatModel&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;//&amp;nbsp;聊天模型（模型相关）" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-4" vertex="1">
          <mxGeometry y="92" width="520" height="26" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-16" value="+ streamingChatModel: StreamingChatModel&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;流式聊天模型（模型相关&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;）&lt;/span&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-4" vertex="1">
          <mxGeometry y="118" width="520" height="26" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-17" value="+ chatMemoryService: ChatMemoryService&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;聊天记忆服务（记忆管理）" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-4" vertex="1">
          <mxGeometry y="144" width="520" height="26" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-24" value="+ toolService = new ToolService(): ToolService&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;工具服务，默认初始化为新实例（工具服务）" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-4" vertex="1">
          <mxGeometry y="170" width="520" height="40" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-18" value="+ guardrailServiceBuilder: GuardrailService.Builder&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;//&amp;nbsp;护栏服务构建器（护栏服务）" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-4" vertex="1">
          <mxGeometry y="210" width="520" height="26" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-19" value="+ guardrailService&amp;nbsp;= new AtomicReference&amp;lt;&amp;gt;();: AtomicReference&amp;lt;GuardrailService&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;护栏服务的原子引用（护栏服务）" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-4" vertex="1">
          <mxGeometry y="236" width="520" height="40" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-20" value="+ moderationModel: ModerationModel&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;//&amp;nbsp;内容审核模型（内容审核）" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-4" vertex="1">
          <mxGeometry y="276" width="520" height="26" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-21" value="+ retrievalAugmentor: RetrievalAugmentor&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;检索增强器（检索增强）" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-4" vertex="1">
          <mxGeometry y="302" width="520" height="26" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-22" value="+ systemMessageProvider: Function&amp;lt;Object, Optional&amp;lt;String&amp;gt;&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;系统消息提供者（消息处理）" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-4" vertex="1">
          <mxGeometry y="328" width="520" height="40" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-23" value="+ chatRequestTransformer: BiFunction&amp;lt;ChatRequest, Object, ChatRequest&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;聊天请求转换器（消息处理）" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-4" vertex="1">
          <mxGeometry y="368" width="520" height="40" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-6" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="8A3YfDJvOuzwQTHRI0gP-4" vertex="1">
          <mxGeometry y="408" width="520" height="8" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-7" value="+ AiServiceContext(Class&amp;lt;?&amp;gt; aiServiceClass) {&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//初始化AI服务上下文（构造函数）&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; this.aiServiceClass = aiServiceClass;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; this.guardrailServiceBuilder = GuardrailService.builder(aiServiceClass);&lt;/div&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-4" vertex="1">
          <mxGeometry y="416" width="520" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-14" value="+&amp;nbsp;&lt;span style=&quot;background-color: transparent;&quot;&gt;boolean hasChatMemory() {&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;&lt;/span&gt;检查是否有聊天记忆（记忆相关）&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return chatMemoryService != null;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-4" vertex="1">
          <mxGeometry y="484" width="520" height="54" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-15" value="+&amp;nbsp;&lt;span style=&quot;background-color: transparent;&quot;&gt;void initChatMemories(ChatMemory chatMemory) {&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;&lt;/span&gt;使用聊天记忆初始化（记忆相关）&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; chatMemoryService = new ChatMemoryService(chatMemory);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-4" vertex="1">
          <mxGeometry y="538" width="520" height="54" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-25" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;//&amp;nbsp;&lt;/span&gt;用聊天记忆提供者初始化（记忆相关）&lt;/div&gt;+&amp;nbsp;&lt;span style=&quot;background-color: transparent;&quot;&gt;void initChatMemories(ChatMemoryProvider chatMemoryProvider) {&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; chatMemoryService = new ChatMemoryService(chatMemoryProvider);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-4" vertex="1">
          <mxGeometry y="592" width="520" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-26" value="+&amp;nbsp;&lt;span style=&quot;background-color: transparent;&quot;&gt;GuardrailService guardrailService() {&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;&lt;/span&gt;获取护栏服务，如果不存在则创建（护栏服务）&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this.guardrailService.updateAndGet(&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; service -&amp;gt; (service != null) ? service : guardrailServiceBuilder.build());&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-4" vertex="1">
          <mxGeometry y="660" width="520" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-63" value="AiServices&amp;lt;T&amp;gt;" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="760" y="80" width="600" height="2694" as="geometry">
            <mxRectangle x="760" y="80" width="120" height="30" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-64" value="+ context: AiServiceContext&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;AiServiceContext上下文对象" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="26" width="600" height="26" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-67" value="+ contentRetrieverSet: boolean&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;跟踪检索增强器设置的标志（DefaultRetrievalAugmentor）" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="52" width="600" height="26" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-70" value="+ retrievalAugmentorSet: boolean&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;跟踪检索增强器设置的标志（只能设置一个）" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="78" width="600" height="26" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-65" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="104" width="600" height="8" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-66" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;//&amp;nbsp;&lt;/span&gt;构造方法 ：接受AiServiceContext参数的受保护构造函数&lt;/div&gt;+&amp;nbsp;&lt;span style=&quot;background-color: transparent;&quot;&gt;protected AiServices(AiServiceContext context) {&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; this.context = context;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="112" width="600" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-68" value="&lt;div&gt;//&amp;nbsp;静态工厂方法 ：&lt;span style=&quot;background-color: transparent;&quot;&gt;创建AI服务实例&lt;/span&gt;&lt;/div&gt;+&amp;nbsp;&lt;span style=&quot;background-color: transparent;&quot;&gt;public static &amp;lt;T&amp;gt; T create(Class&amp;lt;T&amp;gt; aiService, ChatModel chatModel) {&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return builder(aiService).chatModel(chatModel).build();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="180" width="600" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-69" value="+&amp;nbsp;&lt;span style=&quot;background-color: transparent;&quot;&gt;public static &amp;lt;T&amp;gt; T create(Class&amp;lt;T&amp;gt; aiService, StreamingChatModel streamingChatModel) {&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return builder(aiService).streamingChatModel(streamingChatModel).build();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="248" width="600" height="54" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-74" value="+&amp;nbsp;&lt;span style=&quot;background-color: transparent;&quot;&gt;public static &amp;lt;T&amp;gt; AiServices&amp;lt;T&amp;gt; builder(Class&amp;lt;T&amp;gt; aiService) {&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; AiServiceContext context = new AiServiceContext(aiService);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return builder(context);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="302" width="600" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-73" value="+&amp;nbsp;&lt;span style=&quot;background-color: transparent;&quot;&gt;public static &amp;lt;T&amp;gt; AiServices&amp;lt;T&amp;gt; builder(AiServiceContext context) {&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; for (AiServicesFactory factory : loadFactories(AiServicesFactory.class)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return factory.create(context);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return new DefaultAiServices&amp;lt;&amp;gt;(context);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="370" width="600" height="96" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-76" value="&lt;div&gt;//&amp;nbsp;链式配置方法 ：&lt;span style=&quot;background-color: transparent;&quot;&gt;设置各种组件如聊天模型、记忆、工具、护栏等&lt;/span&gt;&lt;/div&gt;+&amp;nbsp;&lt;span style=&quot;background-color: transparent;&quot;&gt;public AiServices&amp;lt;T&amp;gt; chatModel(ChatModel chatModel) {&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.chatModel = chatModel;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="466" width="600" height="82" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-77" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;public AiServices&amp;lt;T&amp;gt; streamingChatModel(StreamingChatModel streamingChatModel) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.streamingChatModel = streamingChatModel;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="548" width="600" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-78" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public AiServices&amp;lt;T&amp;gt; systemMessageProvider(Function&amp;lt;Object, String&amp;gt; systemMessageProvider) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.systemMessageProvider = systemMessageProvider.andThen(Optional::ofNullable);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="616" width="600" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-79" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public AiServices&amp;lt;T&amp;gt; chatMemory(ChatMemory chatMemory) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.initChatMemories(chatMemory);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="684" width="600" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-80" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public AiServices&amp;lt;T&amp;gt; chatMemoryProvider(ChatMemoryProvider chatMemoryProvider) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.initChatMemories(chatMemoryProvider);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="752" width="600" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-81" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public AiServices&amp;lt;T&amp;gt; chatRequestTransformer(UnaryOperator&amp;lt;ChatRequest&amp;gt; chatRequestTransformer) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.chatRequestTransformer = (req, memId) -&amp;gt; chatRequestTransformer.apply(req);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="820" width="600" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-82" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public AiServices&amp;lt;T&amp;gt; tools(Object... objectsWithTools) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return tools(asList(objectsWithTools));&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="888" width="600" height="54" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-83" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public AiServices&amp;lt;T&amp;gt; tools(Collection&amp;lt;Object&amp;gt; objectsWithTools) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.toolService.tools(objectsWithTools);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="942" width="600" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-84" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public AiServices&amp;lt;T&amp;gt; toolProvider(ToolProvider toolProvider) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.toolService.toolProvider(toolProvider);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="1010" width="600" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-85" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public AiServices&amp;lt;T&amp;gt; tools(Map&amp;lt;ToolSpecification, ToolExecutor&amp;gt; tools) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.toolService.tools(tools);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="1078" width="600" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-86" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public AiServices&amp;lt;T&amp;gt; hallucinatedToolNameStrategy(&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Function&amp;lt;ToolExecutionRequest, ToolExecutionResultMessage&amp;gt; hallucinatedToolNameStrategy) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.toolService.hallucinatedToolNameStrategy(hallucinatedToolNameStrategy);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="1146" width="600" height="82" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-87" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public AiServices&amp;lt;T&amp;gt; contentRetriever(ContentRetriever contentRetriever) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (retrievalAugmentorSet) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; throw illegalConfiguration(&quot;Only one out of [retriever, contentRetriever, retrievalAugmentor] can be set&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; contentRetrieverSet = true;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.retrievalAugmentor = DefaultRetrievalAugmentor.builder()&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .contentRetriever(ensureNotNull(contentRetriever, &quot;contentRetriever&quot;))&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .build();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="1228" width="600" height="166" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-88" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public AiServices&amp;lt;T&amp;gt; retrievalAugmentor(RetrievalAugmentor retrievalAugmentor) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (contentRetrieverSet) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; throw illegalConfiguration(&quot;Only one out of [retriever, contentRetriever, retrievalAugmentor] can be set&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; retrievalAugmentorSet = true;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.retrievalAugmentor = ensureNotNull(retrievalAugmentor, &quot;retrievalAugmentor&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="1394" width="600" height="138" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-89" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public AiServices&amp;lt;T&amp;gt; inputGuardrailsConfig(InputGuardrailsConfig inputGuardrailsConfig) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.guardrailServiceBuilder.inputGuardrailsConfig(inputGuardrailsConfig);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="1532" width="600" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-90" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public AiServices&amp;lt;T&amp;gt; outputGuardrailsConfig(OutputGuardrailsConfig outputGuardrailsConfig) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.guardrailServiceBuilder.outputGuardrailsConfig(outputGuardrailsConfig);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="1600" width="600" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-91" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public &amp;lt;I extends InputGuardrail&amp;gt; AiServices&amp;lt;T&amp;gt; inputGuardrailClasses(List&amp;lt;Class&amp;lt;? extends I&amp;gt;&amp;gt; guardrailClasses) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.guardrailServiceBuilder.inputGuardrailClasses(guardrailClasses);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="1668" width="600" height="82" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-92" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public &amp;lt;I extends InputGuardrail&amp;gt; AiServices&amp;lt;T&amp;gt; inputGuardrailClasses(Class&amp;lt;? extends I&amp;gt;... guardrailClasses) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.guardrailServiceBuilder.inputGuardrailClasses(guardrailClasses);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="1750" width="600" height="82" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-93" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public &amp;lt;I extends InputGuardrail&amp;gt; AiServices&amp;lt;T&amp;gt; inputGuardrails(List&amp;lt;I&amp;gt; guardrails) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.guardrailServiceBuilder.inputGuardrails(guardrails);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="1832" width="600" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-94" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public &amp;lt;I extends InputGuardrail&amp;gt; AiServices&amp;lt;T&amp;gt; inputGuardrails(I... guardrails) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.guardrailServiceBuilder.inputGuardrails(guardrails);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="1900" width="600" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-95" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public &amp;lt;O extends OutputGuardrail&amp;gt; AiServices&amp;lt;T&amp;gt; outputGuardrailClasses(List&amp;lt;Class&amp;lt;? extends O&amp;gt;&amp;gt; guardrailClasses) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.guardrailServiceBuilder.outputGuardrailClasses(guardrailClasses);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="1968" width="600" height="82" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-96" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public &amp;lt;O extends OutputGuardrail&amp;gt; AiServices&amp;lt;T&amp;gt; outputGuardrailClasses(Class&amp;lt;? extends O&amp;gt;... guardrailClasses) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.guardrailServiceBuilder.outputGuardrailClasses(guardrailClasses);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="2050" width="600" height="82" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-97" value="&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public &amp;lt;O extends OutputGuardrail&amp;gt; AiServices&amp;lt;T&amp;gt; outputGuardrails(List&amp;lt;O&amp;gt; guardrails) {&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.guardrailServiceBuilder.outputGuardrails(guardrails);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="2132" width="600" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-99" value="&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public &amp;lt;O extends OutputGuardrail&amp;gt; AiServices&amp;lt;T&amp;gt; outputGuardrails(O... guardrails) {&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; context.guardrailServiceBuilder.outputGuardrails(guardrails);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return this;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="2200" width="600" height="68" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-98" value="&lt;span style=&quot;background-color: transparent;&quot;&gt;//&amp;nbsp;抽象方法 ：build()方法由子类（DefaultAiServices&amp;lt;T&amp;gt;）实现，用于构建最终的AI服务实例&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public&lt;/span&gt;&amp;nbsp;abstract T build();" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="2268" width="600" height="40" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-100" value="&lt;span style=&quot;background-color: transparent;&quot;&gt;// 工具方法 ：包含一些辅助方法如removeToolMessages()和verifyModerationIfNeeded()&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;protected void performBasicValidation() {&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (context.chatModel == null &amp;amp;&amp;amp; context.streamingChatModel == null) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; throw illegalConfiguration(&quot;Please specify either chatModel or streamingChatModel&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="2308" width="600" height="96" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-101" value="&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public static List&amp;lt;ChatMessage&amp;gt; removeToolMessages(List&amp;lt;ChatMessage&amp;gt; messages) {&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return messages.stream()&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .filter(it -&amp;gt; !(it instanceof ToolExecutionResultMessage))&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .filter(it -&amp;gt; !(it instanceof AiMessage &amp;amp;&amp;amp; ((AiMessage) it).hasToolExecutionRequests()))&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .collect(toList());&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="2404" width="600" height="96" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-102" value="&lt;span style=&quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;public static void verifyModerationIfNeeded(Future&amp;lt;Moderation&amp;gt; moderationFuture) {&lt;/span&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (moderationFuture != null) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Moderation moderation = moderationFuture.get();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (moderation.flagged()) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; throw new ModerationException(&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; String.format(&quot;Text \&quot;%s\&quot; violates content policy&quot;, moderation.flaggedText()), moderation);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } catch (InterruptedException | ExecutionException e) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; throw new RuntimeException(e);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="8A3YfDJvOuzwQTHRI0gP-63" vertex="1">
          <mxGeometry y="2500" width="600" height="194" as="geometry" />
        </mxCell>
        <mxCell id="8A3YfDJvOuzwQTHRI0gP-75" value="1" style="endArrow=open;html=1;endSize=12;startArrow=diamondThin;startSize=14;startFill=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=bottom;rounded=0;entryX=0.005;entryY=0.025;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="8A3YfDJvOuzwQTHRI0gP-64" target="8A3YfDJvOuzwQTHRI0gP-4" edge="1">
          <mxGeometry x="-1" y="3" relative="1" as="geometry">
            <mxPoint x="1250" y="120" as="sourcePoint" />
            <mxPoint x="1410" y="120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="lLZbtqwOry2NCPCkpnOp-16" value="DefaultAiServices&amp;lt;T&amp;gt;" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fontSize=14;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;locked=0;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="1490" y="960" width="520" height="168" as="geometry">
            <mxRectangle x="1480" y="80" width="150" height="30" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="lLZbtqwOry2NCPCkpnOp-17" value="+ DEFAULT_MESSAGE_PROVIDER: Function&amp;lt;Object, Optional&amp;lt;String&amp;gt;&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;默认消息提供者，返回空的Optional" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="lLZbtqwOry2NCPCkpnOp-16">
          <mxGeometry y="26" width="520" height="40" as="geometry" />
        </mxCell>
        <mxCell id="lLZbtqwOry2NCPCkpnOp-23" value="+ guardrailServiceBuilder: GuardrailService.Builder&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;//&amp;nbsp;护栏服务构建器（护栏服务）" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="lLZbtqwOry2NCPCkpnOp-16">
          <mxGeometry y="66" width="520" height="26" as="geometry" />
        </mxCell>
        <mxCell id="lLZbtqwOry2NCPCkpnOp-29" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="lLZbtqwOry2NCPCkpnOp-16">
          <mxGeometry y="92" width="520" height="8" as="geometry" />
        </mxCell>
        <mxCell id="lLZbtqwOry2NCPCkpnOp-30" value="+ AiServiceContext(Class&amp;lt;?&amp;gt; aiServiceClass) {&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//初始化AI服务上下文（构造函数）&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; this.aiServiceClass = aiServiceClass;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; this.guardrailServiceBuilder = GuardrailService.builder(aiServiceClass);&lt;/div&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="lLZbtqwOry2NCPCkpnOp-16">
          <mxGeometry y="100" width="520" height="68" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
